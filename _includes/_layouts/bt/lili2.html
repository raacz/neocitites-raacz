---
layout: _layouts/bt/reading-mode.html
---

{% assign folderPath = page.inputPath | split: "/" | slice: 0, -1 | join: "/" %}

{% assign dirFiles = collections.all | where_exp: "i", "i.inputPath contains folderPath" %}

{% assign en_item = dirFiles | where_exp: "i", "i.inputPath contains 'en.md'" | first %}
{% assign sp_item = dirFiles | where_exp: "i", "i.inputPath contains 'sp.md'" | first %}
{% assign tok_item = dirFiles | where_exp: "i", "i.inputPath contains 'tok.md'" | first %}

{% assign size = story.tokLines.size | minus: 1 %}

{% assign titlelanguage = "tok" %}

{% if genre == "suli" %}
{% assign titlelanguage = "en" %}
{% endif %}

<div class="selo">

  {% if beforeText %}
  <div class="back-forth">
    <a href="{{ beforeLink }}">{{ beforeText }}</a>
    <a href="{{ nextLink }}">{{ nextText }}</a>
  </div>
  {% endif %}

  <h1 lang="{{ titlelanguage }}" id="main-content">{{ title }}</h1>
  <div class="content-wrap">
    <div class="content">

      <figure class="context">
        <img alt="{{ alt }}" class="{{ genre }}" src="{{ media }}">
        <figcaption>
          <p>
            <span class="caption">{{ alt }}</span>
            {% if external %}
            <span class="attr">
              <a href="{{ external }}">Image: {{ name }}</a>
              |
              by <strong>{{ source }}</strong>.

              {% assign license_match = false %}

              {% for linked_license in licenses %}
              {% if linked_license.key == license %}
              {% assign license_match = true %}
              {% assign license_link = linked_license.link %}
              {% endif %}
              {% endfor %}
              |
              {% if license_match %}

              <a href="{{ license_link }}"> {{ license }}</a>

              {% else %}

              <span>{{ license }} (This link is broken)</span>

              {% endif %}
              {% endif %}
          </p>

        </figcaption>
      </figure>

      <div class="regular">
        <div lang="tok" class="tok">
          <h2>sitelen Lasina</h2>
          {{ tok_item.content }}
        </div>
        {% if en_item %}
        <div lang="en" class="en">
          <h2>English</h2>
          {{ en_item.content }}
        </div>
        {% endif %}
        {% if sp_item %}
        <div lang="tok" class="indented sp">
          <h2>sitelen pona</h2>
          {{ sp_item.content }}
        </div>
        <div lang="tok" class="unindented sp">
          <h2>sitelen pona</h2>
          {% for paragraph in story.spFlattened  %}
              {% assign spLine = paragraph[0] | log %}
              {% assign element =  'p' %}
              {% if spLine contains '###' %}
               {% if spLine contains '####' %}
                  {% assign element =  'h4' %}
                {% else %}
                  {% assign element = 'h3' %}
                {% endif %}
               
              {% endif %}
          
          <{{ element }}>
            {% for sentence in paragraph %}
            {{ sentence | remove: '<br>' | remove: '####' | remove: '###' | remove: 'zz' | remove: '<' | remove: '^>' | remove: '>^' | remove: '^' }} {% if element == 'p' %}<span class="interpunct">.</span><span class="cjk-final">。︁</span>{% endif %}
            {% endfor %}
          </{{ element }}>
          {% endfor %}
        </div>
        {% endif %}
      </div>
      <div class="inject1 table">
        <table>
          <thead>
            <tr>
              <th class="lasina" lang="tok">toki pona</th>
              <th lang="en">English</th>
              <th lang="tok" class="sp">sitelen pona</th>
            </tr>
          </thead>
          <tbody>
            {% for i in (0..size) %}

             {% assign tokLine = story.tokLines[i] %}
              {% assign enLine = story.enLines[i] %}
              {% assign spLine = story.spLines[i] %}
              {% assign element =  'span' %}
              {% assign class =  '' %}


              {% if tokLine contains '###' %}
                {% assign class =  'visible-heading' %}

               {% if tokLine contains '####' %}
                  {% assign element =  'h3' %}
                {% else %}
                  {% assign element = 'h2' %}
                {% endif %}
                {% assign tokLine = story.tokLines[i] | remove: '####' | strip %}
                {% assign enLine = story.enLines[i] | remove: '####' | strip %}
                {% assign spLine = story.spLines[i] | remove: '####' | strip %}
                {% if tokLine contains '###' %}
                  {% assign tokLine = story.tokLines[i] | remove: '###' | strip %}
                  {% assign enLine = story.enLines[i] | remove: '###' | strip %}
                  {% assign spLine = story.spLines[i] | remove: '###' | strip %}
                {% endif %}
              {% endif %}
            <tr class="{{ class }}">
             
              <td class="lasina" lang="tok">
                <{{ element }}>{{ tokLine }}</{{ element }}>
              </td>
              <td lang="en">
                <{{ element }}>{{ enLine }}</{{ element }}>
              </td>
              <td lang="tok" class="indented sp">
                <{{ element }}>{{ spLine }}</{{ element }}>
              </td>
              <td lang="tok" class="unindented sp">
                <div>
                  <{{ element }}>{{ spLine | remove: '<br>' | remove: 'zz' | remove: '<' | remove: '^>' | remove: '>^'
                  | remove: '^' }}</{{ element }}>
                </div>
              </td>
            </tr>
            {% endfor %}
<!-- 
{% for i in (0..size) %}
  {% assign tokLine = story.tokLines[i] %}
  {% assign enLine = story.enLines[i] %}
  {% assign spLine = story.spLines[i] %}
  
  {% if tokLine contains '####' or enLine contains '####' or spLine contains '####' %}
    <tr>
      <td colspan="4">
        <h3>
          {{ tokLine | remove: '####' | strip }} / 
          {{ enLine | remove: '####' | strip }} / 
          {{ spLine | remove: '####' | strip }}
        </h3>
      </td>
    </tr>
  {% elsif tokLine contains '###' or enLine contains '###' or spLine contains '###' %}
    <tr>
      <td colspan="4">
        <h2>
          {{ tokLine | remove: '###' | strip }} / 
          {{ enLine | remove: '###' | strip }} / 
          {{ spLine | remove: '###' | strip }}
        </h2>
      </td>
    </tr>
  {% else %}
    <tr>
      <td lang="tok">{{ tokLine }}</td>
      <td lang="en">{{ enLine }}</td>
      <td class="indented sp">{{ spLine }}</td>
      <td class="unindented sp">{{ spLine | remove: '<br>' | remove: 'zz' | remove: '<' | remove: '^>' | remove: '>^' | remove: '^' }}.</td>
    </tr>
  {% endif %}
{% endfor %}            






-->





          </tbody>
        </table>
      </div>
      <div class="inject2 lines">
        {% for i in (0..size) %}
             {% assign tokLine = story.tokLines[i] %}
              {% assign enLine = story.enLines[i] %}
              {% assign spLine = story.spLines[i] %}
              {% assign element =  'p' %}
              {% assign class =  '' %}


              {% if tokLine contains '###' %}
                {% assign class =  'visible-heading' %}

               {% if tokLine contains '####' %}
                  {% assign element =  'h4' %}
                {% else %}
                  {% assign element = 'h3' %}
                {% endif %}
                {% assign tokLine = story.tokLines[i] | remove: '####' | strip %}
                {% assign enLine = story.enLines[i] | remove: '####' | strip %}
                {% assign spLine = story.spLines[i] | remove: '####' | strip %}
                {% if tokLine contains '###' %}
                  {% assign tokLine = story.tokLines[i] | remove: '###' | strip %}
                  {% assign enLine = story.enLines[i] | remove: '###' | strip %}
                  {% assign spLine = story.spLines[i] | remove: '###' | strip %}
                {% endif %}
              {% endif %}


        <div class="line {{ class }}">
          <{{ element }} lang="tok" class="lasina">{{ tokLine }}</{{ element }}>
          <{{ element }} lang ="tok" class="indented sp">{{ spLine }}</{{ element }}>
          <{{ element }} lang="tok" class="unindented sp">{{ spLine | remove: '<br>' | remove: 'zz' | remove: '<' | remove: '^>' | remove: '>^' |
            remove: '^' }}.</{{ element }}>
          <details lang="en">
            <summary>en</summary>
            <{{ element }}>{{ enLine }}</{{ element }}>
          </details>
          <details class="lasina" lang="tok">
            <summary>sitelen Lasina</summary>
            <{{ element }}>{{ tokLine }}</{{ element }}>
          </details>
        </div>
        {% endfor %}
      </div>
    </div>
  </div>

</div>

<script src="/scripts/mode-configure.js"></script>
<script src="/scripts/mode-configure2.js"></script>

<script>
</script>